<#
# Script Name:              Detect-Dell-CVE-2021-21551.ps1
# Script Author:            MauriceDaly (https://msendpointmgr.com/2021/05/05/detect-and-remove-dell-cve-2021-21551-with-proactive-remediations/)

# Changelog                 
2021.05.06              Initial Checkin add Sycnro RMM Alert                PJM
2021.05.07              Add Syncro Logging                                  PJM


Tested and working 2021.05.06. Combine with auto remediation "Remediate-Dell-CVE-2021-21551.ps1"

Syncro Script Variables:

None

#>
<#    
	.NOTES
	===========================================================================
	 Created with: 	SAPIEN Technologies, Inc., PowerShell Studio 2021 v5.8.188
	 Created on:   	05/05/2021 08:56
	 Created by:   	MauriceDaly
	 Organization: 	Cloudway
	 Filename:     	Detect-CVE202121551.ps1
	===========================================================================
	.DESCRIPTION
		Searches for dbutil_2_3.sys assoicated with Dell CVE-2021-21551
#>

Import-Module $env:SyncroModule

$SystemFile = "dbutil_2_3.sys"
$UserProfileSearch = (Get-ChildItem -Path C:\Users -Filter $SystemFile -Recurse -ErrorAction SilentlyContinue)
$TempSearch = (Get-ChildItem -Path C:\Windows\Temp -Filter $SystemFile -Recurse -ErrorAction SilentlyContinue)
try {
	if ([boolean]$UserProfileSearch -eq $true -or [boolean]$TempSearch -eq $true) {
        Log-Activity -Message "WARNING: Dell-CVE-2021-21551: dbutil_2_3.sys detected" -EventName "Dell-CVE-2021-21551"
        Rmm-Alert -Category 'Dell-CVE-2021-21551' -Body 'Dell dbutil_2_3.sys file has been detected'
		Write-Output "Dell dbutil_2_3.sys file has been detected"; exit 1
	} else {
	    Log-Activity -Message "Info: Dell-CVE-2021-21551: Dell dbutil_2_3.sys file not present on system" -EventName "Dell-CVE-2021-21551"
		Write-Output "Dell dbutil_2_3.sys file not present on system"; exit 0
	}
} catch {
    Log-Activity -Message "Info: Dell-CVE-2021-21551: Issues occured while attempting to detect $SystemFile : $($_.Exception.Message)" -EventName "Dell-CVE-2021-21551"
	Write-Output "Issues occured while attempting to detect $SystemFile : $($_.Exception.Message)"; exit 1
}